{
  "entities": {
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserProfile",
      "type": "object",
      "description": "Represents a user profile with access to the website.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the UserProfile entity."
        },
        "username": {
          "type": "string",
          "description": "The username of the user.",
          "format": "email"
        },
        "deviceId": {
          "type": "string",
          "description": "Identifier for the device associated with the user account. Enforces one user/password per device."
        },
        "themeId": {
          "type": "string",
          "description": "Reference to Theme. (Relationship: Theme 1:N UserProfile). Specifies the selected theme for the user."
        },
        "pageIds": {
          "type": "array",
          "description": "References to Pages created by the user. (Relationship: UserProfile 1:N Page)",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "username",
        "deviceId"
      ]
    },
    "Page": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Page",
      "type": "object",
      "description": "Represents a web page created by a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Page entity."
        },
        "userProfileId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N Page). The user who created the page."
        },
        "title": {
          "type": "string",
          "description": "The title of the page."
        },
        "content": {
          "type": "string",
          "description": "The HTML/JSON content of the page."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp indicating when the page was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userProfileId",
        "title",
        "content"
      ]
    },
    "Theme": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Theme",
      "type": "object",
      "description": "Represents a theme that defines the look and feel of the website.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Theme entity."
        },
        "name": {
          "type": "string",
          "description": "The name of the theme."
        },
        "description": {
          "type": "string",
          "description": "A description of the theme."
        },
        "css": {
          "type": "string",
          "description": "The CSS code for the theme."
        },
        "js": {
          "type": "string",
          "description": "The JavaScript code for the theme."
        }
      },
      "required": [
        "id",
        "name",
        "css",
        "js"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/userProfiles/{userProfileId}",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Stores user profile information. The `deviceId` field is used to enforce one user/password per device. This achieves authorization independence as device authorization does not depend on parent data.",
          "params": [
            {
              "name": "userProfileId",
              "description": "The unique identifier for the user profile."
            }
          ]
        }
      },
      {
        "path": "/themes/{themeId}",
        "definition": {
          "entityName": "Theme",
          "schema": {
            "$ref": "#/backend/entities/Theme"
          },
          "description": "Stores themes that define the look and feel of the website.",
          "params": [
            {
              "name": "themeId",
              "description": "The unique identifier for the theme."
            }
          ]
        }
      },
      {
        "path": "/userProfiles/{userProfileId}/pages/{pageId}",
        "definition": {
          "entityName": "Page",
          "schema": {
            "$ref": "#/backend/entities/Page"
          },
          "description": "Stores pages created by users.  Path-based ownership ensures that only the user who created the page can access it.",
          "params": [
            {
              "name": "userProfileId",
              "description": "The unique identifier for the user profile."
            },
            {
              "name": "pageId",
              "description": "The unique identifier for the page."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to support user accounts, themes, and page creation, ensuring a secure and scalable application.  Authorization Independence is achieved by storing the `deviceId` directly within the `UserProfile` document. This eliminates the need for `get()` calls to parent documents for authorization.  Since each UserProfile is unique, and tied to one device, there is no need for collaborative data structures.  QAPs (Rules are not Filters): The structure facilitates secure `list` operations by ensuring that each collection (`userProfiles`, `themes`, `pages`) contains documents with homogeneous security requirements. Path-based ownership (`/userProfiles/{userProfileId}/pages/{pageId}`) is employed for user-created pages, simplifying security rules and ensuring that only the owning user can access their respective pages."
  }
}